<!-- Lore View - Tabs and header moved to header.html -->
<div x-show="$store.ui.currentView === 'lore'" class="view" x-data="{ activeLoreTab: 'summary' }">

    <!-- Contenido seg√∫n pesta√±a activa -->
    <div x-show="!$store.ui.activeLoreTab || $store.ui.activeLoreTab === 'summary'" class="tab-content">
        <!-- Quick Stats -->
        <div class="dashboard-grid" style="grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); margin-bottom: 24px;">
            <div class="stat-card">
                <div class="stat-icon">
                    <i data-lucide="book-open" width="24" height="24"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-value" x-text="$store.project.loreEntries.length"></div>
                    <div class="stat-label" x-text="$store.i18n.t('lore.title')">Lore</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i data-lucide="users" width="24" height="24"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-value" x-text="$store.project.characters.length"></div>
                    <div class="stat-label" x-text="$store.i18n.t('sidebar.characters')">Personajes</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i data-lucide="heart" width="24" height="24"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-value" x-text="$store.project.getRelationsCount ? $store.project.getRelationsCount() : $store.project.characters.reduce((sum, char) => sum + (char.relationships ? char.relationships.length : 0), 0)"></div>
                    <div class="stat-label" x-text="$store.i18n.t('sidebar.relations')">Relaciones</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i data-lucide="calendar" width="24" height="24"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-value" x-text="$store.project.timeline.length"></div>
                    <div class="stat-label" x-text="$store.i18n.t('sidebar.timeline')">Eventos</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i data-lucide="map-pin" width="24" height="24"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-value" x-text="$store.project.locations.length"></div>
                    <div class="stat-label" x-text="$store.i18n.t('sidebar.locations')">Ubicaciones</div>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="quick-actions" style="margin-bottom: 24px;">
            <h2 x-text="$store.i18n.t('dashboard.quickActions.title')">Acciones R√°pidas</h2>
            <div class="action-buttons">
                <button class="action-btn" @click="$store.ui.openModal('newCharacter')">
                    <i data-lucide="user-plus" width="20" height="20"></i>
                    <span x-text="$store.i18n.t('dashboard.quickActions.newCharacter')">Nuevo Personaje</span>
                </button>
                <button class="action-btn" @click="$store.ui.openModal('newLocation')">
                    <i data-lucide="map-pin-plus" width="20" height="20"></i>
                    <span x-text="$store.i18n.t('dashboard.quickActions.newLocation')">Nueva Ubicaci√≥n</span>
                </button>
                <button class="action-btn" @click="$store.ui.openModal('newLore')">
                    <i data-lucide="book-plus" width="20" height="20"></i>
                    <span x-text="$store.i18n.t('dashboard.quickActions.newLore')">Nuevo Elemento de Lore</span>
                </button>
            </div>
        </div>

        <!-- Recent Lore -->
        <div style="margin-bottom: 24px;">
            <div class="view-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <h2 x-text="$store.i18n.t('lore.title')">Elementos de Lore Recientes</h2>
                <button class="btn-secondary" @click="$store.ui.activeLoreTab = 'lore'">
                    <span x-text="$store.i18n.t('common.viewAll')">Ver Todos</span>
                </button>
            </div>

            <!-- Empty State -->
            <div x-show="$store.project.loreEntries.length === 0" class="empty-state">
                <i data-lucide="book-open" width="64" height="64"></i>
                <p x-text="$store.i18n.t('lore.empty')">No hay elementos de lore creados</p>
                <span class="hint" x-text="$store.i18n.t('lore.emptyHint')">Crea tu primer elemento de lore para construir el mundo de tu historia</span>
                <button class="btn-primary" @click="$store.ui.openModal('newLore')" style="margin-top: 16px;">
                    <i data-lucide="plus" width="16" height="16"></i>
                    <span x-text="$store.i18n.t('lore.new')">Crear Lore</span>
                </button>
            </div>

            <!-- Lore Grid -->
            <div x-show="$store.project.loreEntries.length > 0" class="content-grid">
                <template x-for="lore in $store.project.loreEntries.slice(0, 4)" :key="lore.id">
                    <div class="lore-card card clickable" @click="$store.ui.openModal('editLore', lore)">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px;">
                            <h3 x-text="lore.title" style="margin: 0;"></h3>
                            <div style="display: flex; gap: 8px;">
                                <button class="btn-icon" @click.stop="if(confirm($store.i18n.t('common.confirmDelete'))) { $store.project.deleteLore(lore.id); $store.ui.success($store.i18n.t('notifications.success.loreDeleted'), ''); }" :title="$store.i18n.t('common.delete')">
                                    <i data-lucide="trash-2" width="16" height="16"></i>
                                </button>
                            </div>
                        </div>
                        <p x-text="lore.summary || $store.i18n.t('lore.form.summaryPlaceholder')" style="color: var(--text-secondary); font-size: 14px; margin-bottom: 8px;"></p>
                        <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                            <span class="lore-tag" x-text="$store.i18n.t('lore.form.categories.' + lore.category)" style="background: var(--bg-tertiary); padding: 4px 8px; border-radius: 12px; font-size: 12px; color: var(--text-secondary);"></span>
                            <template x-if="lore.relatedEntities && lore.relatedEntities.length > 0">
                                <span style="font-size: 12px; color: var(--text-tertiary);" x-text="$store.i18n.t('lore.relatedEntities', { count: lore.relatedEntities.length })"></span>
                            </template>
                        </div>
                    </div>
                </template>
            </div>
        </div>

        <!-- Recent Timeline Events -->
        <div style="margin-bottom: 24px;">
            <div class="view-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                <h2 x-text="$store.i18n.t('sidebar.timeline')">Eventos Recientes</h2>
                <button class="btn-secondary" @click="$store.ui.activeLoreTab = 'events'">
                    <span x-text="$store.i18n.t('common.viewAll')">Ver Todos</span>
                </button>
            </div>

            <div x-show="$store.project.timeline.length > 0" style="max-width: 800px;">
                <template x-for="event in $store.project.timeline.slice(0, 3)" :key="event.id">
                    <div class="timeline-event card clickable" style="margin-bottom: 16px;" @click="$store.ui.openModal('editTimelineEvent', event)">
                        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;">
                            <span style="color: var(--accent); font-weight: 600;" x-text="event.date"></span>
                            <h3 x-text="event.event" style="margin: 0;"></h3>
                        </div>
                        <p x-text="event.description" style="color: var(--text-secondary); font-size: 14px; margin: 0;"></p>
                    </div>
                </template>
            </div>

            <div x-show="$store.project.timeline.length === 0" class="empty-state" style="padding: 20px;">
                <i data-lucide="clock" width="32" height="32"></i>
                <p x-text="$store.i18n.t('timeline.noEvents')">No hay eventos temporales</p>
            </div>
        </div>
    </div>

    <!-- Vista de Personajes - Header moved to header.html -->
    <div x-show="$store.ui.activeLoreTab === 'characters'" class="tab-content">

        <!-- Empty State -->
        <div x-show="$store.project.characters.length === 0" class="empty-state">
            <i data-lucide="users" width="64" height="64"></i>
            <p x-text="$store.i18n.t('characters.empty')">No hay personajes creados</p>
            <span class="hint" x-text="$store.i18n.t('characters.emptyHint')">Crea tu primer personaje para comenzar</span>
        </div>

        <!-- Characters Grid -->
        <div x-show="$store.project.characters.length > 0" class="content-grid">
            <template x-for="character in $store.project.characters" :key="character.id">
                <div class="character-card clickable" @click="$store.ui.openModal('editCharacter', character)">
                    <div class="character-header">
                        <div class="character-avatar" x-text="character.name.charAt(0).toUpperCase()"></div>
                        <div class="character-info">
                            <div class="character-name" x-text="character.name"></div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <div class="character-role" x-text="$store.i18n.t('characters.form.roles.' + character.role)"></div>
                                <!-- Estado vital badge (solo si no es alive) -->
                                <template x-if="character.currentVitalStatus && character.currentVitalStatus !== 'alive'">
                                    <span class="badge"
                                          :style="'font-size: 10px; padding: 3px 8px; background: ' + $store.project.getVitalStatusInfo(character.currentVitalStatus).color + '22; color: ' + $store.project.getVitalStatusInfo(character.currentVitalStatus).color + '; border: 1px solid ' + $store.project.getVitalStatusInfo(character.currentVitalStatus).color + '44;'"
                                          x-text="$store.project.getVitalStatusInfo(character.currentVitalStatus).label"></span>
                                </template>
                            </div>
                        </div>
                    </div>
                    <div class="character-description" x-text="character.description || $store.i18n.t('characters.form.descriptionPlaceholder')"></div>
                    <div class="card-actions" style="margin-top: 12px; display: flex; gap: 8px; justify-content: flex-end;">
                        <button class="btn-icon" @click.stop="$store.ui.openModal('vitalStatus', { character: character })" title="Estado vital">
                            <i data-lucide="heart-pulse" width="16" height="16"></i>
                        </button>
                        <button class="btn-icon" @click.stop="if(confirm($store.i18n.t('common.confirmDelete'))) { $store.project.deleteCharacter(character.id); $store.ui.success($store.i18n.t('notifications.success.characterDeleted'), ''); }" :title="$store.i18n.t('common.delete')">
                            <i data-lucide="trash-2" width="16" height="16"></i>
                        </button>
                    </div>
                </div>
            </template>
        </div>
    </div>

    <!-- Vista de Relaciones - Header removed -->
    <div x-show="$store.ui.activeLoreTab === 'relations'" class="tab-content">

        <!-- Empty State -->
        <div x-show="$store.project.characters.length === 0 || $store.project.characters.every(c => !c.relationships || c.relationships.length === 0)" class="empty-state">
            <i data-lucide="heart" width="64" height="64"></i>
            <p x-text="$store.i18n.t('relationships.empty')">No hay relaciones creadas</p>
            <span class="hint" x-text="$store.i18n.t('relationships.emptyHint')">Crea relaciones entre personajes en la secci√≥n de edici√≥n de personajes</span>
        </div>

        <!-- Tabs para vista de relaciones -->
        <div x-show="$store.project.characters.length > 0 && !$store.project.characters.every(c => !c.relationships || c.relationships.length === 0)" style="margin-bottom: 24px;">
            <div class="tabs">
                <button class="tab-btn"
                        :class="{ 'active': !$store.ui.activeRelationsView || $store.ui.activeRelationsView === 'list' }"
                        @click="$store.ui.activeRelationsView = 'list'">
                    <i data-lucide="list" width="16" height="16"></i>
                    <span x-text="$store.i18n.t('common.list')">Lista</span>
                </button>
                <button class="tab-btn"
                        :class="{ 'active': $store.ui.activeRelationsView === 'diagram' }"
                        @click="$store.ui.activeRelationsView = 'diagram'">
                    <i data-lucide="layout-dashboard" width="16" height="16"></i>
                    <span x-text="$store.i18n.t('relationships.diagram')">Diagrama</span>
                </button>
            </div>
        </div>

        <!-- Vista de Lista de Relaciones -->
        <div x-show="(!$store.ui.activeRelationsView || $store.ui.activeRelationsView === 'list') && $store.project.characters.length > 0 && !$store.project.characters.every(c => !c.relationships || c.relationships.length === 0)" style="margin-top: 16px;">
            <div class="content-grid">
                <template x-for="character in $store.project.characters.filter(c => c.relationships && c.relationships.length > 0)" :key="character.id">
                    <div class="card">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                            <h3 x-text="character.name" style="margin: 0;"></h3>
                            <button class="btn-icon"
                                    @click.stop="$store.ui.openModal('newRelationship', { characterId: character.id })"
                                    :title="$store.i18n.t('relationships.addNew')">
                                <i data-lucide="plus" width="16" height="16"></i>
                            </button>
                        </div>
                        <div style="margin-top: 12px;">
                            <template x-for="(relation, relationIndex) in character.relationships" :key="relation.id || (relation.characterId + '-' + relationIndex)">
                                <div class="clickable"
                                     @click="$store.ui.openModal('editRelationship', {
                                        characterId: character.id,
                                        relationship: relation,
                                        relationshipIndex: relationIndex
                                     })"
                                     style="padding: 12px; border-bottom: 1px solid var(--border); cursor: pointer; transition: background 0.2s;"
                                     @mouseenter="$el.style.background = 'var(--bg-tertiary)'"
                                     @mouseleave="$el.style.background = 'transparent'">
                                    <div>
                                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 4px;">
                                            <i data-lucide="heart" width="14" height="14" style="color: var(--accent);"></i>
                                            <span style="font-weight: 500;" x-text="$store.i18n.t('characters.form.relationTypes.' + (relation.currentType || relation.type))"></span>
                                            <span>‚Üí</span>
                                            <span style="font-weight: 500;" x-text="$store.project.getCharacter(relation.characterId)?.name || $store.i18n.t('characters.unknownCharacter')"></span>
                                            <!-- Badge de historial si existe -->
                                            <template x-if="relation.history && relation.history.length > 1">
                                                <span class="badge" style="font-size: 10px; background: rgba(124, 179, 255, 0.2); color: var(--accent);">
                                                    <i data-lucide="clock" width="10" height="10"></i>
                                                    <span x-text="$store.i18n.t('relationships.changesCount', { count: relation.history.length })"></span>
                                                </span>
                                            </template>
                                        </div>
                                        <div style="color: var(--text-secondary); font-size: 12px; margin-left: 22px;" x-text="relation.currentDescription || relation.description || $store.i18n.t('relationships.noDescription')"></div>
                                        <template x-if="relation.currentStatus && relation.currentStatus !== 'active'">
                                            <div style="margin-left: 22px; margin-top: 4px;">
                                                <span class="badge" style="font-size: 10px; padding: 2px 6px;">
                                                    <span x-text="$store.i18n.t('relationships.statuses.' + relation.currentStatus)"></span>
                                                </span>
                                            </div>
                                        </template>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </template>
            </div>
        </div>

        <!-- Vista de Diagrama de Relaciones -->
        <div x-show="$store.ui.activeRelationsView === 'diagram'"
             x-init="$watch('$store.ui.activeRelationsView', (value) => {
                 if (value === 'diagram') {
                     window.relationsDiagramHelper.clearPositionsCache();
                     setTimeout(() => window.relationsDiagramHelper.initDiagram('relations-diagram-container'), 100);
                 }
             })"
             style="margin-top: 16px; height: 600px; background: var(--bg-tertiary); border-radius: 8px; position: relative; overflow: hidden;"
             id="relations-diagram-container">

            <!-- Controles de Zoom -->
            <div style="position: absolute; bottom: 16px; right: 16px; z-index: 200; display: flex; flex-direction: column; gap: 8px;">
                <button class="btn-icon"
                        @click="window.relationsDiagramHelper.zoomIn('relations-diagram-container')"
                        title="Acercar"
                        style="background: var(--bg-secondary); border: 1px solid var(--border); box-shadow: 0 2px 8px rgba(0,0,0,0.2);">
                    <i data-lucide="zoom-in" width="18" height="18"></i>
                </button>
                <button class="btn-icon"
                        @click="window.relationsDiagramHelper.zoomOut('relations-diagram-container')"
                        title="Alejar"
                        style="background: var(--bg-secondary); border: 1px solid var(--border); box-shadow: 0 2px 8px rgba(0,0,0,0.2);">
                    <i data-lucide="zoom-out" width="18" height="18"></i>
                </button>
                <button class="btn-icon"
                        @click="window.relationsDiagramHelper.resetZoom('relations-diagram-container')"
                        title="Restablecer Vista"
                        style="background: var(--bg-secondary); border: 1px solid var(--border); box-shadow: 0 2px 8px rgba(0,0,0,0.2);">
                    <i data-lucide="maximize-2" width="18" height="18"></i>
                </button>
            </div>

            <div id="relations-diagram-content" style="width: 100%; height: 100%; position: relative; transform-origin: center center; transition: transform 0.1s ease-out;">
                <!-- Leyenda e instrucciones -->
                <div style="position: absolute; top: 16px; left: 16px; z-index: 100; background: var(--bg-secondary); padding: 8px 12px; border-radius: 6px; border: 1px solid var(--border); max-width: 300px;">
                    <div style="font-size: 12px; color: var(--text-secondary); margin-bottom: 6px; font-weight: 600;" x-text="$store.i18n.t('relationships.legend')">Leyenda:</div>
                    <div style="display: flex; gap: 12px; flex-wrap: wrap; margin-bottom: 8px;">
                        <div style="display: flex; align-items: center; gap: 4px;">
                            <div style="width: 8px; height: 8px; border-radius: 50%; background: var(--accent);"></div>
                            <span style="font-size: 11px;" x-text="$store.i18n.t('characters.mainCharacter')">Personaje Principal</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 4px;">
                            <div style="width: 6px; height: 6px; border-radius: 50%; background: var(--text-secondary);"></div>
                            <span style="font-size: 11px;" x-text="$store.i18n.t('characters.otherCharacter')">Otro Personaje</span>
                        </div>
                    </div>
                    <div style="font-size: 10px; color: var(--text-tertiary); border-top: 1px solid var(--border); padding-top: 6px;">
                        <div style="margin-bottom: 2px;">üñ±Ô∏è Arrastra para mover</div>
                        <div>üîç Rueda del mouse para zoom</div>
                    </div>
                </div>
                
                <!-- Nodos de personajes -->
                <template x-for="(character, charIndex) in $store.project.characters.filter(c => c.relationships && c.relationships.length > 0)" :key="character.id">
                    <div class="character-node"
                         :data-id="character.id"
                         :title="character.name + ' (' + $store.i18n.t('characters.form.roles.' + character.role) + ')'"
                         :style="(() => {
                             const allCharsWithRelations = $store.project.characters.filter(c => c.relationships && c.relationships.length > 0);
                             const style = window.relationsDiagramHelper.getNodeStyle(character, charIndex, allCharsWithRelations.length);
                             return Object.entries(style).map(([k, v]) => k.replace(/([A-Z])/g, '-$1').toLowerCase() + ':' + v).join(';');
                         })()"
                         @click="$store.ui.selectedCharacter = character"
                         @mouseenter="$el.style.transform = 'translate(-50%, -50%) scale(1.1)'"
                         @mouseleave="$el.style.transform = 'translate(-50%, -50%) scale(1)'"
                         style="position: absolute; display: flex; align-items: center; justify-content: center; color: white; font-size: 12px; font-weight: 600; cursor: pointer; box-shadow: 0 4px 8px rgba(0,0,0,0.3); text-align: center; z-index: 10; transition: transform 0.2s; user-select: none;">
                        <div style="overflow: hidden; text-overflow: ellipsis; line-height: 1.2; padding: 4px;" x-text="character.name"></div>
                    </div>
                </template>
                
                <!-- L√≠neas de relaci√≥n con iconos -->
                <svg style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 1;" viewBox="0 0 100 100" preserveAspectRatio="none">
                    <template x-for="(char, charIdx) in $store.project.characters.filter(c => c.relationships && c.relationships.length > 0)" :key="char.id + '-lines'">
                        <template x-for="(rel, relIdx) in char.relationships" :key="char.id + '-' + rel.characterId + '-' + relIdx">
                            <line
                                :x1="window.relationsDiagramHelper.getNodePosition(char.id, charIdx, $store.project.characters.filter(c => c.relationships && c.relationships.length > 0).length).numericX"
                                :y1="window.relationsDiagramHelper.getNodePosition(char.id, charIdx, $store.project.characters.filter(c => c.relationships && c.relationships.length > 0).length).numericY"
                                :x2="(() => {
                                    const allChars = $store.project.characters.filter(c => c.relationships && c.relationships.length > 0);
                                    const targetIdx = allChars.findIndex(c => c.id === rel.characterId);
                                    if (targetIdx === -1) return 50;
                                    return window.relationsDiagramHelper.getNodePosition(rel.characterId, targetIdx, allChars.length).numericX;
                                })()"
                                :y2="(() => {
                                    const allChars = $store.project.characters.filter(c => c.relationships && c.relationships.length > 0);
                                    const targetIdx = allChars.findIndex(c => c.id === rel.characterId);
                                    if (targetIdx === -1) return 50;
                                    return window.relationsDiagramHelper.getNodePosition(rel.characterId, targetIdx, allChars.length).numericY;
                                })()"
                                :stroke="window.relationsDiagramHelper.getRelationColor(rel.currentType || rel.type)"
                                stroke-width="0.5"
                                :stroke-opacity="0.7" />
                        </template>
                    </template>
                </svg>

                <!-- Iconos en las l√≠neas de relaci√≥n -->
                <template x-for="(char, charIdx) in $store.project.characters.filter(c => c.relationships && c.relationships.length > 0)" :key="char.id + '-icons'">
                    <template x-for="(rel, relIdx) in char.relationships" :key="char.id + '-icon-' + rel.characterId + '-' + relIdx">
                        <div :style="(() => {
                                const allChars = $store.project.characters.filter(c => c.relationships && c.relationships.length > 0);
                                const coords = window.relationsDiagramHelper.getLineCoordinates(char.id, rel.characterId, allChars);
                                if (!coords) return 'display: none;';
                                return 'position: absolute; left: ' + coords.midX + '; top: ' + coords.midY + '; transform: translate(-50%, -50%); background: ' + window.relationsDiagramHelper.getRelationColor(rel.currentType || rel.type) + '; color: white; border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 6px rgba(0,0,0,0.3); z-index: 5; pointer-events: none;';
                            })()"
                            :title="$store.i18n.t('characters.form.relationTypes.' + (rel.currentType || rel.type))">
                            <i :data-lucide="window.relationsDiagramHelper.getRelationIcon(rel.currentType || rel.type)" width="14" height="14"></i>
                        </div>
                    </template>
                </template>
                
                <!-- Informaci√≥n del nodo seleccionado -->
                <template x-if="$store.ui.selectedCharacter">
                    <div style="position: absolute; bottom: 16px; left: 16px; right: 16px; background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 8px; padding: 12px; z-index: 100; box-shadow: 0 4px 12px rgba(0,0,0,0.2);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <div>
                                <div style="font-weight: 600; font-size: 14px;" x-text="$store.ui.selectedCharacter.name"></div>
                                <div style="font-size: 11px; color: var(--text-secondary); text-transform: capitalize;" x-text="$store.i18n.t('characters.form.roles.' + $store.ui.selectedCharacter.role)"></div>
                            </div>
                            <button class="btn-icon" @click="$store.ui.selectedCharacter = null" title="Cerrar">
                                <i data-lucide="x" width="16" height="16"></i>
                            </button>
                        </div>
                        <div style="font-size: 11px; color: var(--text-tertiary); margin-bottom: 8px;" x-text="$store.i18n.t('relationships.title') + ' (' + ($store.ui.selectedCharacter.relationships?.length || 0) + ')'"></div>
                        <div style="max-height: 120px; overflow-y: auto;">
                            <template x-for="rel in window.relationsDiagramHelper.getCharacterRelations($store.ui.selectedCharacter.id, $store.project)" :key="rel.characterId">
                                <div style="padding: 6px 8px; background: var(--bg-primary); border-radius: 6px; margin-bottom: 4px; display: flex; align-items: center; gap: 8px;">
                                    <div style="width: 6px; height: 6px; border-radius: 50%;" :style="'background: ' + window.relationsDiagramHelper.getRelationColor(rel.currentType || rel.type)"></div>
                                    <div style="flex: 1; font-size: 12px;">
                                        <span style="font-weight: 500;" x-text="rel.relatedCharacter?.name || $store.i18n.t('characters.unknownCharacter')"></span>
                                        <span style="color: var(--text-tertiary); font-size: 11px;"> - </span>
                                        <span style="color: var(--text-secondary); font-size: 11px;" x-text="$store.i18n.t('characters.form.relationTypes.' + (rel.currentType || rel.type))"></span>
                                    </div>
                                </div>
                            </template>
                        </div>
                    </div>
                </template>
            </div>
        </div>
    </div>

    <!-- Vista de Eventos - Header moved to header.html -->
    <div x-show="$store.ui.activeLoreTab === 'events'" class="tab-content">

        <!-- Empty State -->
        <div x-show="$store.project.timeline.length === 0" class="empty-state">
            <i data-lucide="calendar" width="64" height="64"></i>
            <p x-text="$store.i18n.t('timeline.empty')">No hay eventos en la l√≠nea temporal</p>
            <span class="hint" x-text="$store.i18n.t('timeline.emptyHint')">Crea tu primer evento</span>
        </div>

        <!-- Timeline List -->
        <div x-show="$store.project.timeline.length > 0" style="max-width: 800px;">
            <template x-for="event in $store.project.timeline" :key="event.id">
                <div class="timeline-event card clickable" style="margin-bottom: 16px;" @click="$store.ui.openModal('editTimelineEvent', event)">
                    <div style="display: flex; justify-content: space-between; align-items: start;">
                        <div style="flex: 1;">
                            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 8px;">
                                <span style="color: var(--accent); font-weight: 600;" x-text="event.date"></span>
                                <h3 x-text="event.event" style="margin: 0;"></h3>
                            </div>
                            <p x-text="event.description" style="color: var(--text-secondary); font-size: 14px; margin: 0;"></p>
                        </div>
                        <div style="display: flex; gap: 8px;">
                            <button class="btn-icon" @click.stop="if(confirm($store.i18n.t('common.confirmDelete'))) { $store.project.deleteTimelineEvent(event.id); $store.ui.success($store.i18n.t('notifications.success.eventDeleted'), ''); }" :title="$store.i18n.t('common.delete')">
                                <i data-lucide="trash-2" width="16" height="16"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </template>
        </div>
    </div>

    <!-- Vista de Ubicaciones - Header moved to header.html -->
    <div x-show="$store.ui.activeLoreTab === 'locations'" class="tab-content">

        <!-- Empty State -->
        <div x-show="$store.project.locations.length === 0" class="empty-state">
            <i data-lucide="map-pin" width="64" height="64"></i>
            <p x-text="$store.i18n.t('locations.empty')">No hay ubicaciones creadas</p>
            <span class="hint" x-text="$store.i18n.t('locations.emptyHint')">Crea tu primera ubicaci√≥n</span>
        </div>

        <!-- Locations Grid -->
        <div x-show="$store.project.locations.length > 0" class="content-grid">
            <template x-for="location in $store.project.locations" :key="location.id">
                <div class="card clickable" @click="$store.ui.openModal('editLocation', location)">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px;">
                        <h3 x-text="location.name" style="margin: 0;"></h3>
                        <div style="display: flex; gap: 8px;">
                            <button class="btn-icon" @click.stop="if(confirm($store.i18n.t('common.confirmDelete'))) { $store.project.deleteLocation(location.id); $store.ui.success($store.i18n.t('notifications.success.locationDeleted'), ''); }" :title="$store.i18n.t('common.delete')">
                                <i data-lucide="trash-2" width="16" height="16"></i>
                            </button>
                        </div>
                    </div>
                    <p x-text="location.description || $store.i18n.t('locations.form.descriptionPlaceholder')" style="color: var(--text-secondary); font-size: 14px;"></p>
                </div>
            </template>
        </div>
    </div>
</div>