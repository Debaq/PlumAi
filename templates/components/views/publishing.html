<div class="view" x-show="$store.ui.currentView === 'publishing'" x-data="{
    ...publishingComponent(),
    sectionsOpen: {
        metadata: true,
        frontMatter: false,
        backMatter: false,
        chapters: true
    },
    toggleSection(section) {
        this.sectionsOpen[section] = !this.sectionsOpen[section];
    }
}" x-cloak>
    <div class="view-header">
        <div style="display: flex; align-items: center; gap: var(--spacing-md);">
            <button @click="$store.ui.sidebarVisible = !$store.ui.sidebarVisible"
                    class="btn-icon"
                    style="background: var(--bg-secondary); border: 1px solid var(--border);"
                    :title="$store.ui.sidebarVisible ? 'Ocultar men칰' : 'Mostrar men칰'">
                <i data-lucide="sidebar" width="20" height="20"></i>
            </button>
            <div>
                <h1 x-text="$store.i18n.t('publishing.title')">Publicaci칩n</h1>
                <p class="subtitle" x-text="$store.i18n.t('publishing.subtitle')">Prepara tu libro para publicar</p>
            </div>
        </div>
    </div>

    <!-- CONFIGURACI칍N KDP -->
    <div class="card" style="margin-bottom: var(--spacing-xl);">
        <div class="card-header">
            <div style="display: flex; align-items: center; gap: var(--spacing-md);">
                <i data-lucide="book-open" width="24" height="24" style="color: var(--accent);"></i>
                <div>
                    <h2 class="card-title">Amazon KDP - Formato Profesional</h2>
                    <p style="font-size: var(--font-size-sm); color: var(--text-secondary); margin-top: var(--spacing-xs);">
                        Especificaciones profesionales con Amazon Endure 11pt, m치rgenes din치micos y estructura completa
                    </p>
                </div>
            </div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--spacing-lg);">
            <!-- TAMA칌O DEL LIBRO -->
            <div>
                <label style="display: block; font-weight: 600; margin-bottom: var(--spacing-md);" x-text="$store.i18n.t('publishing.bookSize.title')">Tama침o del Libro</label>
                <div style="display: flex; flex-direction: column; gap: var(--spacing-sm);">
                    <label class="radio-card" :class="{ 'active': publishingBookSize === 'kdp6x9' }">
                        <input type="radio" x-model="publishingBookSize" value="kdp6x9" style="margin-right: var(--spacing-sm);">
                        <div>
                            <div style="font-weight: 600; font-size: var(--font-size-sm);">6" x 9" (15.24 x 22.86 cm)</div>
                            <div style="font-size: var(--font-size-xs); color: var(--text-secondary);">Est치ndar - M치s usado</div>
                        </div>
                    </label>
                    <label class="radio-card" :class="{ 'active': publishingBookSize === 'kdp5x8' }">
                        <input type="radio" x-model="publishingBookSize" value="kdp5x8" style="margin-right: var(--spacing-sm);">
                        <div>
                            <div style="font-weight: 600; font-size: var(--font-size-sm);">5" x 8" (12.7 x 20.32 cm)</div>
                            <div style="font-size: var(--font-size-xs); color: var(--text-secondary);">Compacto - Novelas</div>
                        </div>
                    </label>
                    <label class="radio-card" :class="{ 'active': publishingBookSize === 'kdp5.5x8.5' }">
                        <input type="radio" x-model="publishingBookSize" value="kdp5.5x8.5" style="margin-right: var(--spacing-sm);">
                        <div>
                            <div style="font-weight: 600; font-size: var(--font-size-sm);">5.5" x 8.5" (13.97 x 21.59 cm)</div>
                            <div style="font-size: var(--font-size-xs); color: var(--text-secondary);">Digest - US Trade</div>
                        </div>
                    </label>
                </div>
            </div>

            <!-- TIPO DE PAPEL -->
            <div>
                <label style="display: block; font-weight: 600; margin-bottom: var(--spacing-md);">Tipo de Papel</label>
                <div style="display: flex; flex-direction: column; gap: var(--spacing-sm);">
                    <label class="radio-card" :class="{ 'active': publishingPaperType === 'cream' }">
                        <input type="radio" x-model="publishingPaperType" value="cream" style="margin-right: var(--spacing-sm);">
                        <div>
                            <div style="font-weight: 600; font-size: var(--font-size-sm);">Papel Crema</div>
                            <div style="font-size: var(--font-size-xs); color: var(--text-secondary);">Recomendado para ficci칩n - Menos fatiga visual</div>
                        </div>
                    </label>
                    <label class="radio-card" :class="{ 'active': publishingPaperType === 'white' }">
                        <input type="radio" x-model="publishingPaperType" value="white" style="margin-right: var(--spacing-sm);">
                        <div>
                            <div style="font-weight: 600; font-size: var(--font-size-sm);">Papel Blanco</div>
                            <div style="font-size: var(--font-size-xs); color: var(--text-secondary);">Para libros con im치genes a color</div>
                        </div>
                    </label>
                </div>
            </div>
        </div>

        <!-- INFO DE ESTIMACI칍N -->
        <div style="margin-top: var(--spacing-lg); padding: var(--spacing-md); background: var(--bg-tertiary); border-radius: 6px; font-size: var(--font-size-sm);">
            <div style="display: flex; align-items: center; gap: var(--spacing-sm); color: var(--text-secondary);">
                <i data-lucide="info" width="16" height="16"></i>
                <span>P치ginas estimadas: <strong x-text="estimatePageCount()"></strong> | M치rgenes: <strong>Din치micos seg칰n grosor</strong></span>
            </div>
        </div>
    </div>

    <div style="display: grid; grid-template-columns: 1fr 400px; gap: var(--spacing-xl);">
        <!-- COLUMNA IZQUIERDA -->
        <div style="display: flex; flex-direction: column; gap: var(--spacing-xl);">

            <!-- METADATOS -->
            <div class="card">
                <div class="card-header" @click="toggleSection('metadata')" style="cursor: pointer;">
                    <div style="display: flex; align-items: center; justify-content: space-between;">
                        <h2 class="card-title" x-text="$store.i18n.t('publishing.metadata.title')">Informaci칩n del Libro</h2>
                        <i data-lucide="chevron-down" width="20" height="20"
                           :style="sectionsOpen.metadata ? 'transform: rotate(180deg);' : ''"
                           style="transition: transform 0.2s; color: var(--text-secondary);"></i>
                    </div>
                </div>
                <div x-show="sectionsOpen.metadata" x-collapse>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--spacing-lg);">
                        <div class="form-group" style="grid-column: 1 / -1;">
                            <label x-text="$store.i18n.t('publishing.metadata.bookTitle')">T칤tulo del Libro *</label>
                            <input type="text" x-model="publishingBookTitle" placeholder="El t칤tulo de tu libro">
                        </div>
                        <div class="form-group">
                            <label>Subt칤tulo (opcional)</label>
                            <input type="text" x-model="publishingSubtitle" placeholder="Subt칤tulo del libro">
                        </div>
                        <div class="form-group">
                            <label x-text="$store.i18n.t('publishing.metadata.author')">Autor *</label>
                            <input type="text" x-model="publishingAuthor" placeholder="Tu nombre">
                        </div>
                        <div class="form-group">
                            <label x-text="$store.i18n.t('publishing.metadata.isbn')">ISBN (opcional)</label>
                            <input type="text" x-model="publishingISBN" placeholder="978-X-XXXX-XXXX-X">
                        </div>
                        <div class="form-group">
                            <label>Editorial (opcional)</label>
                            <input type="text" x-model="publishingPublisher" placeholder="Nombre de la editorial">
                        </div>
                        <div class="form-group">
                            <label>G칠nero</label>
                            <input type="text" x-model="publishingGenre" placeholder="Ficci칩n, No-ficci칩n, etc.">
                        </div>
                        <div class="form-group">
                            <label>A침o</label>
                            <input type="text" x-model="publishingYear" placeholder="2025">
                        </div>
                    </div>
                </div>
            </div>

            <!-- FRONT MATTER (Estructura Preliminar) -->
            <div class="card">
                <div class="card-header" @click="toggleSection('frontMatter')" style="cursor: pointer;">
                    <div style="display: flex; align-items: center; justify-content: space-between;">
                        <div>
                            <h2 class="card-title">
                                <i data-lucide="file-text" width="20" height="20" style="vertical-align: middle;"></i>
                                Estructura Preliminar (Front Matter)
                            </h2>
                            <p style="font-size: var(--font-size-sm); color: var(--text-secondary); margin-top: var(--spacing-xs);">
                                Contenido que aparece antes de los cap칤tulos (opcional)
                            </p>
                        </div>
                        <i data-lucide="chevron-down" width="20" height="20"
                           :style="sectionsOpen.frontMatter ? 'transform: rotate(180deg);' : ''"
                           style="transition: transform 0.2s; color: var(--text-secondary);"></i>
                    </div>
                </div>
                <div x-show="sectionsOpen.frontMatter" x-collapse>

                <div style="display: flex; flex-direction: column; gap: var(--spacing-lg);">
                    <!-- Otros libros del autor -->
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: var(--spacing-xs);">
                            <i data-lucide="book-open" width="16" height="16"></i>
                            Otros libros del autor
                        </label>
                        <textarea x-model="publishingOtherBooks"
                                  placeholder="Lista de tus otros libros (uno por l칤nea)&#10;Ejemplo:&#10;El Viaje del H칠roe&#10;Cuentos de Fantas칤a&#10;La 칔ltima Batalla"
                                  rows="3"
                                  style="width: 100%; padding: var(--spacing-md); background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 4px; color: var(--text-primary); font-family: inherit; resize: vertical;"></textarea>
                        <small style="color: var(--text-secondary); font-size: var(--font-size-xs);">Aparecer치 en el reverso de la portadilla</small>
                    </div>

                    <!-- Dedicatoria -->
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: var(--spacing-xs);">
                            <i data-lucide="heart" width="16" height="16"></i>
                            Dedicatoria
                        </label>
                        <textarea x-model="publishingDedication"
                                  placeholder="A quien dedicas este libro...&#10;Ejemplo:&#10;Para mi familia, que siempre crey칩 en m칤."
                                  rows="2"
                                  style="width: 100%; padding: var(--spacing-md); background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 4px; color: var(--text-primary); font-family: inherit; resize: vertical;"></textarea>
                        <small style="color: var(--text-secondary); font-size: var(--font-size-xs);">Aparecer치 en p치gina IMPAR despu칠s del copyright</small>
                    </div>

                    <!-- Pr칩logo -->
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: var(--spacing-xs);">
                            <i data-lucide="file-text" width="16" height="16"></i>
                            Pr칩logo
                        </label>
                        <textarea x-model="publishingPrologue"
                                  placeholder="Pr칩logo del libro (contexto, introducci칩n)..."
                                  rows="6"
                                  style="width: 100%; padding: var(--spacing-md); background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 4px; color: var(--text-primary); font-family: inherit; resize: vertical;"></textarea>
                        <small style="color: var(--text-secondary); font-size: var(--font-size-xs);">Se formatear치 profesionalmente con sangr칤a y justificaci칩n</small>
                    </div>
                </div>
                </div>
            </div>

            <!-- BACK MATTER (Estructura Final) -->
            <div class="card">
                <div class="card-header" @click="toggleSection('backMatter')" style="cursor: pointer;">
                    <div style="display: flex; align-items: center; justify-content: space-between;">
                        <div>
                            <h2 class="card-title">
                                <i data-lucide="file-plus" width="20" height="20" style="vertical-align: middle;"></i>
                                Estructura Final (Back Matter)
                            </h2>
                            <p style="font-size: var(--font-size-sm); color: var(--text-secondary); margin-top: var(--spacing-xs);">
                                Contenido que aparece despu칠s de los cap칤tulos
                            </p>
                        </div>
                        <i data-lucide="chevron-down" width="20" height="20"
                           :style="sectionsOpen.backMatter ? 'transform: rotate(180deg);' : ''"
                           style="transition: transform 0.2s; color: var(--text-secondary);"></i>
                    </div>
                </div>
                <div x-show="sectionsOpen.backMatter" x-collapse>

                <div style="display: flex; flex-direction: column; gap: var(--spacing-lg);">
                    <!-- Ep칤logo -->
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: var(--spacing-xs);">
                            <i data-lucide="bookmark" width="16" height="16"></i>
                            Ep칤logo (opcional)
                        </label>
                        <textarea x-model="publishingEpilogue"
                                  placeholder="Ep칤logo del libro (conclusi칩n, cierre)..."
                                  rows="6"
                                  style="width: 100%; padding: var(--spacing-md); background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 4px; color: var(--text-primary); font-family: inherit; resize: vertical;"></textarea>
                    </div>

                    <!-- Agradecimientos -->
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: var(--spacing-xs);">
                            <i data-lucide="users" width="16" height="16"></i>
                            Agradecimientos (opcional)
                        </label>
                        <textarea x-model="publishingAcknowledgments"
                                  placeholder="Agradece a editores, beta readers, familia, amigos..."
                                  rows="4"
                                  style="width: 100%; padding: var(--spacing-md); background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 4px; color: var(--text-primary); font-family: inherit; resize: vertical;"></textarea>
                    </div>

                    <!-- Sobre el Autor -->
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: var(--spacing-xs);">
                            <i data-lucide="user" width="16" height="16"></i>
                            Sobre el Autor (recomendado)
                        </label>
                        <textarea x-model="publishingAboutAuthor"
                                  placeholder="Biograf칤a del autor (100-300 palabras). Usa tercera persona. Ejemplo:&#10;&#10;John Doe es un autor de fantas칤a 칠pica nacido en Madrid. Ha publicado tres novelas best-sellers y vive en Barcelona con su familia..."
                                  rows="5"
                                  style="width: 100%; padding: var(--spacing-md); background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 4px; color: var(--text-primary); font-family: inherit; resize: vertical;"></textarea>
                    </div>

                    <!-- Foto del autor -->
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: var(--spacing-xs);">
                            <i data-lucide="camera" width="16" height="16"></i>
                            Foto del Autor (opcional)
                        </label>
                        <div style="display: flex; align-items: center; gap: var(--spacing-md);">
                            <div x-show="publishingAuthorPhoto"
                                 style="width: 80px; height: 80px; border-radius: 50%; overflow: hidden; border: 2px solid var(--border);">
                                <img :src="publishingAuthorPhoto" alt="Foto del autor" style="width: 100%; height: 100%; object-fit: cover;">
                            </div>
                            <div x-show="!publishingAuthorPhoto"
                                 style="width: 80px; height: 80px; border-radius: 50%; background: var(--bg-tertiary); border: 2px dashed var(--border); display: flex; align-items: center; justify-content: center;">
                                <i data-lucide="user" width="32" height="32" style="color: var(--text-tertiary);"></i>
                            </div>
                            <div style="flex: 1;">
                                <input type="file" id="authorPhotoUpload" accept="image/*" style="display: none;" @change="handleAuthorPhotoUpload($event)">
                                <div style="display: flex; gap: var(--spacing-sm);">
                                    <button class="btn-secondary btn-sm" @click="$el.parentElement.querySelector('#authorPhotoUpload').click()">
                                        <i data-lucide="upload" width="14" height="14"></i>
                                        <span x-text="publishingAuthorPhoto ? 'Cambiar' : 'Subir foto'"></span>
                                    </button>
                                    <button x-show="publishingAuthorPhoto" class="btn-secondary btn-sm" @click="removeAuthorPhoto()">
                                        <i data-lucide="trash-2" width="14" height="14"></i>
                                    </button>
                                </div>
                                <small style="display: block; margin-top: var(--spacing-xs); color: var(--text-secondary); font-size: var(--font-size-xs);">
                                    Recomendado: cuadrada, m칤nimo 300x300px
                                </small>
                            </div>
                        </div>
                    </div>

                    <!-- Informaci칩n de contacto -->
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: var(--spacing-xs);">
                            <i data-lucide="mail" width="16" height="16"></i>
                            Informaci칩n de Contacto (opcional)
                        </label>
                        <div style="display: flex; flex-direction: column; gap: var(--spacing-sm);">
                            <input type="text"
                                   x-model="publishingContactInfo.website"
                                   placeholder="Sitio web: www.tuautor.com"
                                   style="padding: var(--spacing-sm); background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 4px; color: var(--text-primary);">
                            <input type="text"
                                   x-model="publishingContactInfo.social"
                                   placeholder="Redes sociales: @tuautor en Twitter/Instagram"
                                   style="padding: var(--spacing-sm); background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 4px; color: var(--text-primary);">
                            <input type="text"
                                   x-model="publishingContactInfo.newsletter"
                                   placeholder="Newsletter: Suscr칤bete en www.tuautor.com/newsletter"
                                   style="padding: var(--spacing-sm); background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 4px; color: var(--text-primary);">
                        </div>
                        <small style="color: var(--text-secondary); font-size: var(--font-size-xs);">Aparecer치 al final de "Sobre el Autor"</small>
                    </div>
                </div>
                </div>
            </div>

            <!-- SELECCI칍N DE CAP칈TULOS -->
            <div class="card">
                <div class="card-header" @click="toggleSection('chapters')" style="cursor: pointer;">
                    <div style="display: flex; align-items: center; justify-content: space-between;">
                        <div>
                            <h2 class="card-title" x-text="$store.i18n.t('publishing.chapters.title')">Cap칤tulos</h2>
                            <p style="font-size: var(--font-size-sm); color: var(--text-secondary); margin-top: var(--spacing-xs);">
                                <span x-text="publishingFilteredChapters.length + ' cap칤tulos disponibles'"></span> 췅
                                <span x-text="publishingSelectedChapters.length + ' seleccionados'"></span> 췅
                                <span x-text="publishingTotalWords + ' palabras'"></span>
                            </p>
                        </div>
                        <i data-lucide="chevron-down" width="20" height="20"
                           :style="sectionsOpen.chapters ? 'transform: rotate(180deg);' : ''"
                           style="transition: transform 0.2s; color: var(--text-secondary);"></i>
                    </div>
                </div>
                <div x-show="sectionsOpen.chapters" x-collapse>

                <!-- FILTROS -->
                <div style="display: flex; gap: var(--spacing-sm); margin-bottom: var(--spacing-lg); flex-wrap: wrap;">
                    <button class="btn-secondary btn-sm"
                            :class="{ 'active': publishingChapterFilter === 'final' }"
                            @click="publishingChapterFilter = 'final'"
                            style="display: flex; align-items: center; gap: var(--spacing-xs);">
                        <i data-lucide="check-circle" width="14" height="14"></i>
                        <span x-text="$store.i18n.t('publishing.chapters.onlyFinal')">Solo finales</span>
                    </button>
                    <button class="btn-secondary btn-sm"
                            :class="{ 'active': publishingChapterFilter === 'review' }"
                            @click="publishingChapterFilter = 'review'">
                        <span x-text="$store.i18n.t('publishing.chapters.showReview')">Mostrar en revisi칩n</span>
                    </button>
                    <button class="btn-secondary btn-sm"
                            :class="{ 'active': publishingChapterFilter === 'all' }"
                            @click="publishingChapterFilter = 'all'">
                        <span x-text="$store.i18n.t('publishing.chapters.statusAll')">Todos</span>
                    </button>
                    <div style="flex: 1;"></div>
                    <button class="btn-secondary btn-sm" @click="publishingSelectAllFiltered()">
                        <span x-text="$store.i18n.t('publishing.chapters.selectAll')">Seleccionar todos</span>
                    </button>
                </div>

                <!-- LISTA DE CAP칈TULOS -->
                <div x-show="publishingFilteredChapters.length === 0" class="empty-state" style="padding: var(--spacing-xl);">
                    <i data-lucide="book-open" width="48" height="48"></i>
                    <p x-text="$store.i18n.t('publishing.chapters.noChapters')">No hay cap칤tulos</p>
                </div>

                <div x-show="publishingFilteredChapters.length > 0" style="display: flex; flex-direction: column; gap: var(--spacing-sm); max-height: 400px; overflow-y: auto;">
                    <template x-for="chapter in publishingFilteredChapters" :key="chapter.id">
                        <div class="chapter-selector-item"
                             style="display: flex; align-items: center; gap: var(--spacing-md); padding: var(--spacing-md); background: var(--bg-tertiary); border-radius: 6px; cursor: pointer; border: 2px solid transparent;"
                             :style="publishingSelectedChapters.includes(chapter.id) ? 'border-color: var(--accent);' : ''"
                             @click="toggleChapterSelection(chapter.id)">
                            <input type="checkbox" :checked="publishingSelectedChapters.includes(chapter.id)"
                                   @click.stop="toggleChapterSelection(chapter.id)"
                                   style="width: 18px; height: 18px; cursor: pointer;">
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: var(--spacing-sm);">
                                    <span style="color: var(--text-tertiary); font-weight: 600;" x-text="'Cap. ' + chapter.number"></span>
                                    <span style="font-weight: 600;" x-text="chapter.title"></span>
                                    <!-- Badge de estado -->
                                    <span x-show="chapter.status === 'final'" style="font-size: 10px; padding: 2px 6px; background: var(--success); color: white; border-radius: 4px; font-weight: 600;">FINAL</span>
                                    <span x-show="chapter.status === 'review'" style="font-size: 10px; padding: 2px 6px; background: var(--warning); color: white; border-radius: 4px; font-weight: 600;">REVISI칍N</span>
                                    <span x-show="chapter.status === 'draft'" style="font-size: 10px; padding: 2px 6px; background: var(--text-tertiary); color: white; border-radius: 4px; font-weight: 600;">BORRADOR</span>
                                </div>
                                <div style="font-size: var(--font-size-xs); color: var(--text-secondary); margin-top: 2px;">
                                    <span x-text="Math.round((chapter.content?.split(' ').length || 0)) + ' palabras'"></span>
                                </div>
                            </div>
                            <i data-lucide="check" width="20" height="20"
                               x-show="publishingSelectedChapters.includes(chapter.id)"
                               style="color: var(--accent);"></i>
                        </div>
                    </template>
                </div>
                </div>
            </div>

            <!-- IM츼GENES DEL LIBRO -->
            <div class="card">
                <div class="card-header">
                    <div style="display: flex; align-items: center; justify-content: space-between;">
                        <div>
                            <h2 class="card-title" x-text="$store.i18n.t('publishing.images.title')">Im치genes</h2>
                            <p style="font-size: var(--font-size-sm); color: var(--text-secondary); margin-top: var(--spacing-xs);">
                                Puedes elegir d칩nde insertar cada imagen en el selector desplegable
                            </p>
                        </div>
                        <button class="btn-secondary btn-sm" @click="$refs.bookImageInput.click()">
                            <i data-lucide="plus" width="14" height="14"></i>
                            <span x-text="$store.i18n.t('publishing.images.addImage')">Agregar</span>
                        </button>
                    </div>
                </div>
                <input type="file" x-ref="bookImageInput" accept="image/*" style="display: none;" @change="handleImageUpload($event)">

                <div x-show="publishingBookImages.length === 0" class="empty-state" style="padding: var(--spacing-lg);">
                    <p x-text="$store.i18n.t('publishing.images.noImages')">Sin im치genes</p>
                </div>

                <div x-show="publishingBookImages.length > 0" style="display: flex; flex-direction: column; gap: var(--spacing-md);">
                    <template x-for="(img, index) in publishingBookImages" :key="index">
                        <div style="display: flex; align-items: start; gap: var(--spacing-md); padding: var(--spacing-md); background: var(--bg-tertiary); border-radius: 6px; border: 2px solid var(--border);">
                            <img :src="img.dataUrl" style="width: 80px; height: 100px; object-fit: cover; border-radius: 4px; border: 1px solid var(--border);">
                            <div style="flex: 1;">
                                <label style="display: block; font-weight: 600; margin-bottom: var(--spacing-xs); font-size: var(--font-size-sm);">
                                    <i data-lucide="map-pin" width="14" height="14" style="vertical-align: middle;"></i>
                                    Posici칩n en el libro:
                                </label>
                                <select x-model="img.position"
                                        style="width: 100%; padding: var(--spacing-sm); background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 4px; color: var(--text-primary); font-size: var(--font-size-sm);">
                                    <option value="beginning">游닀 Al inicio del libro (Front Matter)</option>
                                    <template x-for="chapter in $store.project.chapters" :key="chapter.id">
                                        <option :value="'after-' + chapter.id" x-text="'游늯 Despu칠s de Cap칤tulo ' + chapter.number + ': ' + chapter.title"></option>
                                    </template>
                                    <option value="end">游늿 Al final del libro (Back Matter)</option>
                                </select>
                                <small style="display: block; margin-top: var(--spacing-xs); color: var(--text-secondary); font-size: var(--font-size-xs);">
                                    La imagen aparecer치 en una p치gina completa
                                </small>
                            </div>
                            <button class="btn-icon" @click="removeBookImage(img.id)" style="margin-top: 20px;">
                                <i data-lucide="trash-2" width="16" height="16"></i>
                            </button>
                        </div>
                    </template>
                </div>
            </div>
        </div>

        <!-- COLUMNA DERECHA - PORTADA Y EXPORTACI칍N -->
        <div style="display: flex; flex-direction: column; gap: var(--spacing-xl); position: sticky; top: var(--spacing-xl);">

            <!-- PORTADA -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title" x-text="$store.i18n.t('publishing.cover.title')">Portada</h2>
                </div>
                <div style="text-align: center;">
                    <div x-show="!publishingCoverImage"
                         style="width: 100%; height: 400px; background: var(--bg-tertiary); border: 2px dashed var(--border); border-radius: 6px; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: var(--spacing-md);">
                        <i data-lucide="image" width="48" height="48" style="color: var(--text-tertiary);"></i>
                        <span style="font-size: var(--font-size-sm); color: var(--text-tertiary);" x-text="$store.i18n.t('publishing.cover.noCover')">Sin portada</span>
                    </div>
                    <div x-show="publishingCoverImage"
                         style="width: 100%; height: 400px; background: var(--bg-tertiary); border-radius: 6px; overflow: hidden; border: 1px solid var(--border);">
                        <img :src="publishingCoverImage" alt="Cover" style="width: 100%; height: 100%; object-fit: contain;">
                    </div>

                    <p style="font-size: var(--font-size-xs); color: var(--text-secondary); margin: var(--spacing-md) 0;" x-text="$store.i18n.t('publishing.cover.recommendation')">
                        Recomendado: 1600x2400px
                    </p>

                    <input type="file" id="coverUpload" accept="image/*" style="display: none;" @change="handleCoverUpload($event)">
                    <div style="display: flex; gap: var(--spacing-sm); justify-content: center;">
                        <button x-show="!publishingCoverImage" class="btn-primary" @click="$el.parentElement.querySelector('#coverUpload').click()">
                            <i data-lucide="upload" width="16" height="16"></i>
                            <span x-text="$store.i18n.t('publishing.cover.upload')">Subir</span>
                        </button>
                        <button x-show="publishingCoverImage" class="btn-secondary btn-sm" @click="$el.parentElement.querySelector('#coverUpload').click()">
                            <i data-lucide="refresh-cw" width="14" height="14"></i>
                            <span x-text="$store.i18n.t('publishing.cover.change')">Cambiar</span>
                        </button>
                        <button x-show="publishingCoverImage" class="btn-secondary btn-sm" @click="publishingCoverImage = null">
                            <i data-lucide="trash-2" width="14" height="14"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- EXPORTAR -->
            <div class="card" style="background: var(--accent); color: white;">
                <div style="margin-bottom: var(--spacing-lg);">
                    <h2 style="font-size: var(--font-size-lg); font-weight: 600; margin-bottom: var(--spacing-sm);"
                        x-text="$store.i18n.t('publishing.export.title')">Exportar</h2>

                    <div x-show="!publishingIsValid()" style="font-size: var(--font-size-sm); opacity: 0.9;">
                        <span x-text="$store.i18n.t('publishing.validation.warnings')">Advertencias:</span>
                        <ul style="margin: var(--spacing-sm) 0 0 var(--spacing-lg); list-style: disc;">
                            <li x-show="!publishingBookTitle" x-text="$store.i18n.t('publishing.validation.noTitle')"></li>
                            <li x-show="!publishingAuthor" x-text="$store.i18n.t('publishing.validation.noAuthor')"></li>
                            <li x-show="publishingSelectedChapters.length === 0" x-text="$store.i18n.t('publishing.validation.noChapters')"></li>
                        </ul>
                    </div>
                    <div x-show="publishingIsValid()" style="font-size: var(--font-size-sm); opacity: 0.9; display: flex; align-items: center; gap: var(--spacing-sm);">
                        <i data-lucide="check-circle" width="16" height="16"></i>
                        <span x-text="$store.i18n.t('publishing.validation.ready')">Listo</span>
                    </div>
                </div>

                <div style="display: flex; flex-direction: column; gap: var(--spacing-sm);">
                    <button @click="exportToPDF()"
                            :disabled="!publishingIsValid()"
                            style="width: 100%; padding: var(--spacing-lg); background: white; color: var(--accent); border: none; border-radius: 6px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: var(--spacing-md);"
                            :style="!publishingIsValid() ? 'opacity: 0.5; cursor: not-allowed;' : ''">
                        <i data-lucide="file-text" width="20" height="20"></i>
                        <span x-text="$store.i18n.t('publishing.export.exportPDF')">Exportar PDF</span>
                    </button>

                    <button @click="exportToDOCX()"
                            :disabled="!publishingIsValid()"
                            style="width: 100%; padding: var(--spacing-lg); background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.3); border-radius: 6px; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: var(--spacing-md);"
                            :style="!publishingIsValid() ? 'opacity: 0.5; cursor: not-allowed;' : ''">
                        <i data-lucide="file-code" width="20" height="20"></i>
                        <span x-text="$store.i18n.t('publishing.export.exportDOCX')">Exportar DOCX</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
