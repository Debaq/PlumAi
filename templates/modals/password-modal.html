<!-- Password Modal -->
<div class="legacy-modal" :class="{ 'active': $store.ui.modals.password }">
    <div class="legacy-modal-content" style="max-width: 450px;">
        <div class="legacy-modal-header">
            <h2 x-text="$store.ui.modalData?.title || 'Contraseña Requerida'">Contraseña Requerida</h2>
            <button class="btn-close" @click="$store.ui.closeModal('password'); if($store.ui.modalData?.onCancel) $store.ui.modalData.onCancel()">
                <i data-lucide="x" width="20" height="20"></i>
            </button>
        </div>
        <div class="modal-body">
            <p x-text="$store.ui.modalData?.message || 'Este proyecto tiene datos encriptados. Ingresa la contraseña para acceder.'" style="margin-bottom: 16px;">
                Este proyecto tiene datos encriptados. Ingresa la contraseña para acceder.
            </p>

            <form @submit.prevent="
                const password = $el.querySelector('[name=password]').value;
                if (!password) {
                    $store.ui.error('Error', 'La contraseña no puede estar vacía');
                    return;
                }
                if($store.ui.modalData?.onSubmit) {
                    $store.ui.modalData.onSubmit(password);
                    $store.ui.closeModal('password');
                }
                $el.reset();
            ">
                <div class="form-group">
                    <label>Contraseña</label>
                    <input
                        type="password"
                        name="password"
                        required
                        placeholder="Ingresa tu contraseña"
                        autofocus
                        style="width: 100%;"
                    >
                </div>

                <template x-if="$store.ui.modalData?.showEncryptionOptions">
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" name="encryptProject">
                            <span>Encriptar todo el proyecto</span>
                        </label>
                        <p class="hint">Si está activado, todo el contenido del proyecto se encriptará. Si no, solo las API keys serán encriptadas.</p>
                    </div>
                </template>

                <template x-if="$store.ui.modalData?.showRememberOption">
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" name="rememberPassword">
                            <span>Recordar en esta sesión</span>
                        </label>
                        <p class="hint">La contraseña se guardará solo mientras tengas la pestaña abierta (no se almacena en disco).</p>
                    </div>
                </template>

                <div class="modal-footer" style="margin-top: 24px;">
                    <button
                        type="button"
                        class="btn-secondary"
                        @click="$store.ui.closeModal('password'); if($store.ui.modalData?.onCancel) $store.ui.modalData.onCancel()"
                    >
                        Cancelar
                    </button>
                    <button type="submit" class="btn-primary">
                        <i data-lucide="lock" width="16" height="16"></i>
                        <span x-text="$store.ui.modalData?.submitText || 'Desencriptar'">Desencriptar</span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
